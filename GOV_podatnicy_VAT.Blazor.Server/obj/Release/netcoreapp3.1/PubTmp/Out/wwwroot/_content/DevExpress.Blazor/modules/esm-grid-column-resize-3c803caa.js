import"./esm-chunk-d81494b9.js";import"./esm-chunk-a2731447.js";import{ensureElement as e,RequestAnimationFrame as t,addClassNameToElement as i,getLeftRightPaddings as s}from"./esm-dom-utils-aa188e06.js";import{g as n}from"./esm-chunk-9c16a801.js";import{T as o}from"./esm-chunk-1b6abd73.js";import{K as l}from"./esm-chunk-808bf349.js";import{ensureAccentColorStyle as h}from"./esm-dx-style-helper-4f7c588c.js";function r(e){window.dxAccessibilityHelper||(window.dxAccessibilityHelper=new d),window.dxAccessibilityHelper.sendMessageToAssistiveTechnology(e)}class d{constructor(){this._helperElement=null}get helperElement(){return null==this._helperElement&&(this._helperElement=this.createHelperElement()),this._helperElement}createHelperElement(){const e=document.createElement("DIV");return e.className="dxAIFE dxAIFME",e.setAttribute("role","note"),e.setAttribute("aria-live","assertive"),document.documentElement.appendChild(e),e}sendMessageToAssistiveTechnology(e){this.helperElement.innerHTML=e,setTimeout(()=>{this.helperElement.innerHTML=""},300)}}const a={Disabled:0,NextColumn:1,Component:2},u=0,m=1,c=2,_=30;class g{constructor(e,t,i,s){this._mainElement=e,this._nextHeaderCellElement=e.nextElementSibling,this._blazorComponent=s,this._gridResizeProxy=t,this._mode=i,this._resizeParameters={},this._resizeAnchor=null,this._lastWidth=null,this._lastNextWidth=null,this._timeoutId=null,this._leftMouseXBoundary=null,this._rightMouseXBoundary=null,this._initWidth=null,this._initNextWidth=null,this._allWidth=null,this._totalDiffX=0}get mainElement(){return this._mainElement}get nextHeaderCellElement(){return this._nextHeaderCellElement}get hasNextColumn(){return!!this._nextHeaderCellElement}get hasColumnId(){return this.mainElement.hasAttribute("data-dxdg-column-id")}get gridResizeProxy(){return this._gridResizeProxy}get blazorComponent(){return this._blazorComponent}get resizeAnchor(){return this._resizeAnchor}get caption(){return this.mainElement.innerText}get isResizeAllowed(){return this._mode!==a.Disabled&&this.hasColumnId&&(this.hasNextColumn||this._mode===a.Component)}get step(){let e=Math.ceil((this._resizeParameters.maxWidth-this._resizeParameters.minWidth)/100);return e>5&&(e=5),e}initialize(){this.createResizeAnchor(),M().initializeHeaderCellEvents(this),this.initializeEvents()}initializeEvents(){this.isResizeAllowed&&(this.mainElement.addEventListener("focus",this.onFocus.bind(this)),this.mainElement.addEventListener("keydown",this.onKeyDown.bind(this)),this.mainElement.addEventListener("keyup",this.onKeyUp.bind(this)))}onFocus(e){n(e)===this.mainElement&&(this.onFocusCore(),this.updateResizeParameters())}onKeyDown(e){if(n(e)===this.mainElement)switch(e.keyCode){case l.Left:this.onKeyResize(-this.step),e.stopPropagation(),e.preventDefault();break;case l.Right:this.onKeyResize(this.step),e.stopPropagation(),e.preventDefault()}}onKeyResize(e){this._lastWidth||this.onStartKeyResize();let i=1500;this.hasNextColumn&&(i=this._lastWidth+this._lastNextWidth);const s=this._lastWidth+e;s>30&&(this._totalDiffX+=e),t(function(){this.setWidth(s,i,this._totalDiffX)}.bind(this)),this._timeoutId&&clearTimeout(this._timeoutId)}onStartKeyResize(){this._lastWidth=this.mainElement.getBoundingClientRect().width,this._lastNextWidth=this.hasNextColumn?this.nextHeaderCellElement.getBoundingClientRect().width:0,this.gridResizeProxy.initializeComponensWidths(),this._totalDiffX=0}onKeyUp(e){if(n(e)!==this.mainElement)return;const t=e.keyCode;t===l.Left&&t===l.Right&&(this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=setTimeout(()=>this.invokeSetWidth(),500))}updateResizeParameters(){const e=this.mainElement.getBoundingClientRect().width,t=this.hasNextColumn?this.nextHeaderCellElement.getBoundingClientRect().width:0,i=this.isResizeAllowed;let s=1500;this._mode===a.NextColumn&&(s=e+t-30),this._resizeParameters={allowResize:i,minWidth:i?30:e,currentWidth:e,maxWidth:i?s:e}}update(e){const t=this.isResizeAllowed;this._nextHeaderCellElement=this.mainElement.nextElementSibling,this._mode=e,this.isResizeAllowed?t||(this.mainElement.appendChild(this._resizeAnchor),M().initializeHeaderCellEvents(this)):t&&(this.mainElement.removeChild(this._resizeAnchor),M().removeHeaderCellEvents(this))}createResizeAnchor(){const e=document.createElement("div");i(e,"dxColumnResizeAnchor"),e.dxResizableHeaderCell=this,this._resizeAnchor=e,this.mainElement.appendChild(e)}onMouseDown(){this.setMouseBoundaries(),this.onFocusCore(),this.gridResizeProxy.initializeComponensWidths()}setMouseBoundaries(){const e=this.mainElement.getBoundingClientRect(),t=Math.min(30,e.width);if(this._leftMouseXBoundary=e.left+t-10,this._initWidth=e.width,this._mode===a.NextColumn){const t=this.nextHeaderCellElement.getBoundingClientRect();this._rightMouseXBoundary=e.right+t.width-30,this._initNextWidth=t.width,this._allWidth=e.width+t.width}}removeMouseBoundaries(){this._leftMouseXBoundary=null,this._rightMouseXBoundary=null,this._initWidth=null,this._initNextWidth=null,this._allWidth=null}getResizeType(e){return e<=this._leftMouseXBoundary?m:this._rightMouseXBoundary&&e>=this._rightMouseXBoundary?c:u}onFocusCore(){this.isResizeAllowed&&(this.ensureWidthSyncronized(),r(`Width is ${this.mainElement.offsetWidth} pixels. Use arrow keys to resize.`))}onDragResizeAnchor(e,t){if(!this.isResizeAllowed)return;const i=this.getResizeType(t),s=this.getNewWidth(e,i);i===m&&(e=s-this._initWidth),this.setWidth(s,this._allWidth,e)}getNewWidth(e,t){switch(t){case m:{const e=this.mainElement.getBoundingClientRect().width;return Math.min(30,e)}case c:return this._allWidth-30;default:return this._initWidth+e}}onDragResizeAnchorStop(){this.removeMouseBoundaries(),this.invokeSetWidth()}setWidth(e,t,i){if(!this.isWidthChanged(e)||!this.isValidWidth(e,t,i))return!1;const n=(o=this.mainElement,"border-box"===window.getComputedStyle(o,null).getPropertyValue("box-sizing")?0:s(o));var o;const l=t-(e-=n)-n;return this._lastWidth=e,this._lastNextWidth=l,this.gridResizeProxy.setWidth(this._mode,e,l,i),!0}isWidthChanged(e){return e!==this._lastWidth}invokeSetWidth(){this._lastWidth&&this._lastNextWidth&&(this.gridResizeProxy.resetWidth(),M().lockResize(),this.blazorComponent.invokeMethodAsync("SetColumnWidths",W(this.mainElement),this._lastWidth,W(this.nextHeaderCellElement),this._lastNextWidth).then(()=>{this._lastWidth=null,this._lastNextWidth=null,M().unlockResize()}))}isValidWidth(e,t,i){let s=e>=30||(this._lastWidth?e>this._lastWidth:i>0);return s&&this._mode!==a.Component&&(s=e<=t-30),s}ensureWidthSyncronized(){if(this.isWidthSyncronized())return;const e=this.gridResizeProxy;this.blazorComponent.invokeMethodAsync("GetCellCache").then(t=>{e.syncronizeWidth(t)})}isWidthSyncronized(){let e=!1;const t=this.gridResizeProxy.getColElementInlineWidth();if(0===t)e=!0;else{e=t===this.mainElement.getBoundingClientRect().width}return e}}class z{constructor(e,t){this.mainElement=e,this.update(t)}get colElements(){return R(this._colElements,this._resizeElements.colElements)}get elementsToSetComponentWidth(){return R(this._elementsToSetComponentWidth,this._resizeElements.elementsToSetComponentWidth)}get elementsToSyncWidth(){return R(this._elementsToSyncWidth,this._resizeElements.elementsToSyncWidth)}get elementsToCheckScroll(){return R(this._elementsToCheckScroll,this._resizeElements.elementsToCheckScroll)}get elementsToReset(){return R(this._elementsToReset,this._resizeElements.elementsToReset)}update(e){this._resizeElements=e,this._colElements=null,this._elementsToSetComponentWidth=null,this._elementsToSyncWidth=null,this._elementsToCheckScroll=null,this._elementsToReset=null,this._initWidths=null}setWidth(e,t,i,s){r(t+" pixels"),this.setComponentWidth(s),this.colElements.forEach(s=>{s.style.width=y(t),e===a.NextColumn&&(s.nextElementSibling.style.width=y(i))})}setComponentWidth(e){if(!this.elementsToSetComponentWidth)return;if(this.isScrollExists())return;const t=[],i=this._initWidths;this.elementsToSetComponentWidth.forEach(s=>t.push(new p(s,i.get(s)+e))),this.elementsToSyncWidth&&t.push(new p(this.elementsToSyncWidth[0],i.get(this.elementsToSyncWidth[1])+e)),t.forEach(e=>e.apply())}initializeComponensWidths(){if(!this.elementsToSetComponentWidth)return;const e=new Map;if(this.elementsToSetComponentWidth.forEach(t=>e.set(t,t.getBoundingClientRect().width)),this.elementsToSyncWidth){const t=this.elementsToSyncWidth[1];e.set(t,t.getBoundingClientRect().width)}this._initWidths=e}isScrollExists(){const e=this.elementsToCheckScroll;if(!e)return;return e[0].clientWidth<e[1].clientWidth}getColElementInlineWidth(){let e=0;const t=this.colElements;for(let i=0;i<t.length;i++){const s=t[i].style.width;if(""!==s){e=parseInt(s);break}}return e}syncronizeWidth(i){t((function(){const t=i.map((function(t){const i=e(t[0]);return i?{width:i.getBoundingClientRect().width,cols:v(t[1])}:null})).filter(e=>e);for(let e=0;e<t.length;e++){const i=t[e].cols;for(let s=0;s<i.length;s++)i[s].style.width=y(t[e].width)}}))}resetWidth(){this.elementsToReset&&!this.isScrollExists()&&this.elementsToReset.forEach(e=>{e.style.width=null})}}class p{constructor(e,t){this._element=e,this._width=t}apply(){this._element.style.width=y(this._width)}}class E{constructor(){this._pageX=-1,this._resizeLock=0,this._resizableHeaderCell=null}get pageX(){return this._pageX}get resizableHeaderCell(){return this._resizableHeaderCell}initializeHeaderCellEvents(e){this.initializeMouseDown(e.resizeAnchor)}initializeMouseDown(e){e.addEventListener(o.touchMouseDownEventName,w)}initializeMouseMove(){document.addEventListener(o.touchMouseMoveEventName,f)}initializeMouseUp(){document.addEventListener(o.touchMouseUpEventName,x)}removeHeaderCellEvents(e){e.resizeAnchor.removeEventListener(o.touchMouseDownEventName,w)}onMouseDown(e,t){this._resizableHeaderCell=e,e.onMouseDown(),this._pageX=t,this.initializeMouseMove(),this.initializeMouseUp()}lockResize(){this._resizeLock++}unlockResize(){this._resizeLock--}isResizeLocked(){return this._resizeLock>0}invalidateState(){this._pageX=-1,this._resizableHeaderCell=null}}function W(e){if(!e)return(-1).toString();return e.getAttribute("data-dxdg-column-id").split("|")[0]}function C(e){return e.pageX||e.changedTouches&&e.changedTouches[0].pageX||0}function w(e){const t=M(),i=n(e).dxResizableHeaderCell;if(i&&i.isResizeAllowed){const s=C(e);t.onMouseDown(i,s)}}function f(e){const i=M();if(i.isResizeLocked()||-1===i.pageX)return;const s=C(e),n=s-i.pageX;if(0!==n){const e=i.resizableHeaderCell;e&&t((function(){e.onDragResizeAnchor(n,s)}))}}function x(){const e=M();e.resizableHeaderCell.onDragResizeAnchorStop(),e.invalidateState(),document.removeEventListener(o.touchMouseMoveEventName,f),document.removeEventListener(o.touchMouseUpEventName,x)}function y(e){return e+"px"}function R(e,t){return t?(e||(e=v(t)),e):null}function v(e){return e.map(e=>document.getElementById(e))}function M(){return null===window.dxResizeEventManagerInstance&&(window.dxResizeEventManagerInstance=new E),window.dxResizeEventManagerInstance}window.dxResizeEventManagerInstance=null;const S=new Map;function T(t,i,s,n){if(!(t=e(t)))return;let o=S.get(t);if(o)o.update(s),o.gridResizeProxy.update(i);else{const e=new z(t,i);o=new g(t,e,s,n),o.isResizeAllowed&&(o.initialize(),S.set(t,o))}return h(),Promise.resolve("ok")}const b={initResizeColumn:T};export default b;export{a as ColumnResizeMode,T as initResizeColumn,_ as minColumnWidth};
